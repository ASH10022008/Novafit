<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaFit Tracker - Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            transition: background-color 0.5s, color 0.5s; /* Smooth transition for theme change */
        }
        /* --- Dark Mode Styles (Default) --- */
        .neon-gradient {
            background: linear-gradient(135deg, #0f172a, #7e22ce, #06b6d4);
            background-size: 600% 600%;
            animation: gradientShift 16s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* --- Particle System Styles --- */
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0; /* Ensure particles are behind content */
            overflow: hidden;
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: rgba(126, 34, 206, 0.6); /* Purple */
            animation: glow 1s infinite alternate, flow var(--duration) ease-in-out infinite both;
            box-shadow: 0 0 5px rgba(126, 34, 206, 0.8), 0 0 10px rgba(6, 182, 212, 0.5); /* Blue glow */
            opacity: 0;
        }

        @keyframes glow {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes flow {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            50% {
                transform: translate(var(--flow-x, 0), var(--flow-y, 0)) scale(1.2);
            }
        }
        
        /* Custom style for the circular progress bar */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        /* Style for the floating action button (FAB) */
        #fab {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        #fab:hover {
            transform: scale(1.05);
        }
        /* Style for the custom dialog/modal */
        dialog {
            border: none;
        }
        dialog::backdrop {
            background-color: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body class="neon-gradient text-white flex flex-col items-center p-4 min-h-screen">

    <!-- Particle Container (Z-index 0) -->
    <div id="particles-container"></div>

    <!-- Header & User ID Display (Z-index 10) -->
    <header class="w-full max-w-4xl flex justify-between items-center py-4 px-2 z-10">
        <h1 class="text-3xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-300">NovaFit</h1>
        <div id="user-info" class="text-xs text-gray-400 p-2 bg-gray-900/50 rounded-lg shadow-inner">
            <span id="user-id-display" class="font-mono">Connecting...</span>
        </div>
    </header>

    <main id="app-container" class="w-full max-w-4xl p-2 space-y-6 z-10">

        <!-- BMI and Calorie Goal Card (Main Dashboard) -->
        <section id="dashboard" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            
            <!-- Daily Goal / Progress Card -->
            <div class="daily-goal-card p-6 rounded-xl shadow-2xl backdrop-blur-md bg-white/10 border border-purple-500/30 md:col-span-2">
                <h2 class="text-xl font-semibold mb-4 text-purple-300">Daily Progress</h2>
                <div class="flex items-center space-x-4">
                    <!-- Progress Ring -->
                    <div class="relative w-24 h-24">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <circle class="progress-ring__background text-gray-700" stroke-width="3" stroke="currentColor" fill="transparent" r="15.9155" cx="18" cy="18"/>
                            <circle id="calorie-progress-circle" class="progress-ring__circle" stroke-width="3" stroke="#8b5cf6" fill="transparent" r="15.9155" cx="18" cy="18" stroke-dasharray="0, 100"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="calorie-percentage" class="text-lg font-bold text-purple-300">0%</span>
                        </div>
                    </div>
                    <!-- Stats -->
                    <div class="text-sm">
                        <p class="mb-1">Goal: <span id="goal-calories" class="font-bold text-green-400">2000</span> kcal</p>
                        <p class="mb-1">Consumed: <span id="consumed-calories" class="font-bold text-yellow-400">0</span> kcal</p>
                        <p>Remaining: <span id="remaining-calories" class="font-bold text-red-400">2000</span> kcal</p>
                    </div>
                </div>
            </div>

            <!-- Profile/BMI Card -->
            <div id="profile-card" class="daily-goal-card p-6 rounded-xl shadow-2xl backdrop-blur-md bg-white/10 border border-blue-500/30">
                <h2 class="text-xl font-semibold mb-4 text-blue-300">My Profile</h2>
                <p class="text-sm mb-2">Weight: <span id="display-weight" class="font-bold">--</span> kg</p>
                <p class="text-sm mb-2">Height: <span id="display-height" class="font-bold">--</span> cm</p>
                <p class="text-sm">BMI: <span id="display-bmi" class="font-bold text-green-400">--</span></p>
                <button onclick="document.getElementById('profile-modal').showModal()" class="mt-4 w-full p-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition duration-200 shadow-md">Edit Profile</button>
            </div>
        </section>

        <!-- Activity Log Card -->
        <section class="activity-log-card p-6 rounded-xl shadow-2xl backdrop-blur-md bg-white/10 border border-teal-500/30">
            <h2 class="text-xl font-semibold mb-4 text-teal-300">Today's Activity Log</h2>
            <div id="activity-log" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                <!-- Log entries will be inserted here -->
                <p id="empty-log-message" class="text-gray-500 italic">No activities logged yet. Ensure Firebase is connected.</p>
            </div>
            <button id="clear-log-btn" class="mt-4 p-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition duration-200 shadow-md hidden">Clear Today's Log</button>
        </section>

    </main>
    
    <!-- Floating Action Button (FAB) for Manual Entry (Z-index 20) -->
    <button id="fab" onclick="document.getElementById('entry-modal').showModal()" class="p-4 rounded-full bg-green-500 text-white shadow-lg hover:bg-green-600 z-20">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
    </button>

    <!-- Modals (Z-index 30) -->

    <!-- Manual Entry Modal -->
    <dialog id="entry-modal" class="p-6 rounded-xl shadow-2xl backdrop-blur-md bg-gray-800/90 text-white border border-green-500/30 w-11/12 md:w-1/3 z-30">
        <h3 class="text-2xl font-bold mb-4 text-green-400">Log Activity</h3>
        <form id="entry-form" class="space-y-4">
            <div>
                <label for="food-item" class="block text-sm font-medium mb-1">Item / Activity</label>
                <input type="text" id="food-item" required class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-green-500 text-white">
            </div>
            <div>
                <label for="calorie-count" class="block text-sm font-medium mb-1">Calories (kcal)</label>
                <input type="number" id="calorie-count" required min="1" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-green-500 text-white">
            </div>
            <div class="flex justify-end space-x-2">
                <button type="button" onclick="document.getElementById('entry-modal').close()" class="p-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white">Cancel</button>
                <button type="submit" class="p-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-medium">Add Entry</button>
            </div>
        </form>
    </dialog>

    <!-- Profile/Goal Modal -->
    <dialog id="profile-modal" class="p-6 rounded-xl shadow-2xl backdrop-blur-md bg-gray-800/90 text-white border border-blue-500/30 w-11/12 md:w-1/3 z-30">
        <h3 class="text-2xl font-bold mb-4 text-blue-400">Edit Profile & Goals</h3>
        
        <form id="profile-form" class="space-y-4 mb-6 p-4 border border-gray-700 rounded-lg">
            <h4 class="text-lg font-semibold text-blue-300">Body Metrics</h4>
            <div>
                <label for="weight-input" class="block text-sm font-medium mb-1">Weight (kg)</label>
                <input type="number" id="weight-input" required min="1" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
            </div>
            <div>
                <label for="height-input" class="block text-sm font-medium mb-1">Height (cm)</label>
                <input type="number" id="height-input" required min="1" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 text-white">
            </div>
            <button type="submit" class="w-full p-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition duration-200">Save Metrics</button>
        </form>

        <form id="goal-form" class="space-y-4 p-4 border border-gray-700 rounded-lg">
            <h4 class="text-lg font-semibold text-purple-300">Calorie Goal</h4>
            <div>
                <label for="goal-input" class="block text-sm font-medium mb-1">Daily Calorie Goal (kcal)</label>
                <input type="number" id="goal-input" required min="500" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-purple-500 text-white">
            </div>
            <button type="submit" class="w-full p-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-medium transition duration-200">Set Goal</button>
        </form>
        
        <div class="flex justify-end mt-4">
            <button type="button" onclick="document.getElementById('profile-modal').close()" class="p-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white">Close</button>
        </div>
    </dialog>

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase Log Level for debugging in console
        setLogLevel('debug');

        // --- Global Firebase and App State ---
        let db, auth, app;
        let userId = null; // Current user ID
        let isAuthReady = false; // Flag to ensure we only run Firestore ops when auth is confirmed
        
        // Retrieve mandatory environment variables
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;


        // --- Application Data Model ---
        let appData = {
            profile: {
                weight: 0, // kg
                height: 0, // cm
                goalCalories: 2000, // kcal
            },
            activityLog: [] // [{ id: timestamp, item: string, calories: number, date: yyyy-mm-dd }]
        };

        // --- Firebase Data Persistence Functions ---

        /**
         * Generates the Firestore document path for the current user's private data.
         * @returns {string | null} The Firestore path string or null if userId is not set.
         */
        function getUserDocumentPath() {
            if (!userId) {
                console.error("Attempted to get document path before user ID was set.");
                return null;
            }
            // Firestore path: /artifacts/{appId}/users/{userId}/data/userDocument
            return `artifacts/${appId}/users/${userId}/data/userDocument`;
        }

        /**
         * Saves the current appData state to Firestore.
         */
        async function saveUserDataToFirestore() {
            if (!isAuthReady || !userId) {
                console.warn("Auth not ready or user not logged in. Cannot save data.");
                return;
            }

            const docPath = getUserDocumentPath();
            if (!docPath) return;

            try {
                // Use setDoc to replace the entire document content
                await setDoc(doc(db, docPath), appData);
                console.log("Data saved successfully for user:", userId);
            } catch (error) {
                console.error("Error saving data:", error);
            }
        }

        /**
         * Sets up a real-time listener for the user's data document in Firestore.
         */
        function setupRealtimeListener() {
            if (!isAuthReady || !userId) {
                console.warn("Auth not ready or user not logged in. Cannot setup listener.");
                return;
            }
            
            const docPath = getUserDocumentPath();
            if (!docPath) return;

            // onSnapshot provides real-time updates to appData
            onSnapshot(doc(db, docPath), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const remoteData = docSnapshot.data();
                    
                    // Update appData with fetched data, ensuring activityLog is an array
                    appData = {
                        profile: { ...appData.profile, ...remoteData.profile },
                        activityLog: Array.isArray(remoteData.activityLog) ? remoteData.activityLog : []
                    };
                    console.log("Data loaded from Firestore (Real-time update).");
                } else {
                    console.log("No data found for user. Initializing and saving defaults.");
                    // If no document exists, save the default state to Firestore immediately
                    saveUserDataToFirestore();
                }
                renderApp(); // Render UI after data is updated/loaded
            }, (error) => {
                console.error("Error setting up real-time listener:", error);
            });
        }
        
        // --- Core Application Logic ---

        /**
         * Calculates BMI from weight (kg) and height (cm).
         * @returns {string} The calculated BMI rounded to 2 decimal places.
         */
        function calculateBMI() {
            const weight = appData.profile.weight;
            const heightMeters = appData.profile.height / 100;
            if (weight > 0 && heightMeters > 0) {
                const bmi = weight / (heightMeters * heightMeters);
                return bmi.toFixed(2);
            }
            return '--';
        }

        /**
         * Renders the current application state to the UI.
         */
        function renderApp() {
            const today = new Date().toISOString().split('T')[0];
            const todayEntries = appData.activityLog.filter(entry => entry.date === today);
            const totalConsumed = todayEntries.reduce((sum, entry) => sum + entry.calories, 0);
            const goal = appData.profile.goalCalories || 2000;
            
            // 1. Profile and BMI
            document.getElementById('display-weight').textContent = appData.profile.weight > 0 ? `${appData.profile.weight} kg` : '--';
            document.getElementById('display-height').textContent = appData.profile.height > 0 ? `${appData.profile.height} cm` : '--';
            document.getElementById('display-bmi').textContent = calculateBMI();
            document.getElementById('weight-input').value = appData.profile.weight || '';
            document.getElementById('height-input').value = appData.profile.height || '';
            document.getElementById('goal-input').value = goal;

            // 2. Daily Progress
            const remaining = goal - totalConsumed;
            const percentage = Math.min(100, (totalConsumed / goal) * 100);
            const circumference = 2 * Math.PI * 15.9155;
            const dashoffset = circumference - (percentage / 100) * circumference;

            document.getElementById('goal-calories').textContent = goal;
            document.getElementById('consumed-calories').textContent = totalConsumed;
            document.getElementById('remaining-calories').textContent = Math.max(0, remaining);
            document.getElementById('calorie-percentage').textContent = `${Math.round(percentage)}%`;
            
            const progressCircle = document.getElementById('calorie-progress-circle');
            
            if (progressCircle) {
                progressCircle.style.strokeDasharray = `${circumference}, ${circumference}`;
                progressCircle.style.strokeDashoffset = dashoffset;
                
                // Set circle color based on progress
                if (remaining < 0) {
                    progressCircle.setAttribute('stroke', '#ef4444'); // red
                } else if (percentage >= 100) {
                    progressCircle.setAttribute('stroke', '#10b981'); // emerald/green
                } else {
                    progressCircle.setAttribute('stroke', '#8b5cf6'); // purple
                }
            }

            // 3. Activity Log
            const logContainer = document.getElementById('activity-log');
            const emptyLogMessage = document.getElementById('empty-log-message');
            const clearLogBtn = document.getElementById('clear-log-btn');
            
            if (logContainer) logContainer.innerHTML = '';
            
            if (todayEntries.length === 0) {
                if (emptyLogMessage) emptyLogMessage.style.display = 'block';
                if (clearLogBtn) clearLogBtn.classList.add('hidden');
            } else {
                if (emptyLogMessage) emptyLogMessage.style.display = 'none';
                if (clearLogBtn) clearLogBtn.classList.remove('hidden');

                todayEntries.sort((a, b) => b.id - a.id); // Show newest first
                
                todayEntries.forEach(entry => {
                    const logItem = document.createElement('div');
                    logItem.className = 'flex justify-between items-center p-3 bg-gray-700/50 rounded-lg shadow-sm';
                    logItem.innerHTML = `
                        <p class="text-sm font-medium">${entry.item}</p>
                        <div class="flex items-center space-x-3">
                            <span class="text-xs font-bold text-yellow-300">${entry.calories} kcal</span>
                            <button data-id="${entry.id}" class="remove-entry text-red-400 hover:text-red-500 transition duration-150">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    `;
                    if (logContainer) logContainer.appendChild(logItem);
                });
                
                // Re-attach listeners for the new remove buttons
                document.querySelectorAll('.remove-entry').forEach(button => {
                    button.onclick = handleRemoveEntry;
                });
            }
        }

        // --- Handlers (UPDATED to call saveUserDataToFirestore) ---

        /**
         * Simple confirm action wrapper (used to replace window.confirm).
         * @returns {boolean} Returns true to allow the action to proceed.
         */
        function confirmAction(message) {
             console.warn(`Assuming confirmation for action: ${message}`);
             return true; 
        }

        /**
         * Handles the submission of the profile form (weight/height).
         */
        function handleProfileSubmit(e) {
            e.preventDefault();
            const weight = parseFloat(document.getElementById('weight-input').value);
            const height = parseFloat(document.getElementById('height-input').value);

            appData.profile.weight = weight;
            appData.profile.height = height;
            
            saveUserDataToFirestore(); // Calls Firestore save
            document.getElementById('profile-modal').close();
        }

        /**
         * Handles the submission of the goal form.
         */
        function handleGoalSubmit(e) {
            e.preventDefault();
            const goal = parseInt(document.getElementById('goal-input').value, 10);
            
            appData.profile.goalCalories = goal;
            
            saveUserDataToFirestore(); // Calls Firestore save
            document.getElementById('profile-modal').close();
        }

        /**
         * Handles the submission of the manual activity entry form.
         */
        function handleEntrySubmit(e) {
            e.preventDefault();
            const item = document.getElementById('food-item').value.trim();
            const calories = parseInt(document.getElementById('calorie-count').value, 10);
            const today = new Date().toISOString().split('T')[0];

            if (item && calories > 0) {
                const newEntry = {
                    id: Date.now(), 
                    item: item,
                    calories: calories,
                    date: today
                };
                appData.activityLog.push(newEntry);
                
                saveUserDataToFirestore(); // Calls Firestore save
                
                // Clear form and close modal
                document.getElementById('entry-form').reset();
                document.getElementById('entry-modal').close();
            }
        }

        /**
         * Handles removing a single entry from the log.
         */
        function handleRemoveEntry(e) {
            const id = parseInt(e.currentTarget.dataset.id, 10);
            
            if (confirmAction('Are you sure you want to remove this entry?')) {
                appData.activityLog = appData.activityLog.filter(entry => entry.id !== id);
                saveUserDataToFirestore(); // Calls Firestore save
            }
        }

        /**
         * Handles clearing all entries for the current day.
         */
        function handleClearLog() {
            if (confirmAction('Are you sure you want to clear ALL log entries for today?')) {
                const today = new Date().toISOString().split('T')[0];
                appData.activityLog = appData.activityLog.filter(entry => entry.date !== today);
                saveUserDataToFirestore(); // Calls Firestore save
            }
        }

        // --- Particle System Logic (Kept from novafit35.html) ---

        function generateParticles() {
            const container = document.getElementById('particles-container');
            if (!container) return;

            const numParticles = 30; 
            const duration = 15; // Animation duration in seconds (randomized)

            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random position
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;

                // Random size (2px to 5px)
                const size = Math.random() * 3 + 2; 
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                // Random duration and delay for the flow animation
                particle.style.setProperty('--duration', `${Math.random() * 10 + duration}s`);
                particle.style.animationDelay = `-${Math.random() * duration}s, -${Math.random() * duration}s`;

                // Random flow offsets (for the CSS variable in the flow keyframe)
                const flowX = Math.random() * 200 - 100;
                const flowY = Math.random() * 200 - 100;
                particle.style.setProperty('--flow-x', `${flowX}px`);
                particle.style.setProperty('--flow-y', `${flowY}px`);

                container.appendChild(particle);
            }
        }

        // --- Setup Functions ---

        function setupProfileForms() {
            document.getElementById('profile-form').onsubmit = handleProfileSubmit;
        }
        
        function setupNavigation() {
            // Placeholder for future navigation logic if needed
        }
        
        function setupManualEntry() {
            document.getElementById('entry-form').onsubmit = handleEntrySubmit;
        }

        function setupGoalForm() {
            document.getElementById('goal-form').onsubmit = handleGoalSubmit;
        }

        function setupClearLog() {
            document.getElementById('clear-log-btn').onclick = handleClearLog;
        }

        // --- Firebase Initialization and Auth ---

        /**
         * Initializes Firebase and authenticates the user.
         */
        async function setupFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is empty. Cannot initialize.");
                    document.getElementById('user-id-display').textContent = 'Error: No Config';
                    return;
                }

                // Initialize services
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in process
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Fallback to anonymous sign-in if no token is available
                    await signInAnonymously(auth);
                }

                // Listener to get user ID and start data listener
                auth.onAuthStateChanged(user => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        
                        // Display the full user ID
                        const userIdDisplay = document.getElementById('user-id-display');
                        if (userIdDisplay) userIdDisplay.textContent = `User ID: ${userId}`;
                        
                        setupRealtimeListener(); // Start data fetching/sync
                    } else {
                        console.log("User logged out or failed to sign in.");
                        document.getElementById('user-id-display').textContent = 'Guest (Not Signed In)';
                    }
                });

            } catch (error) {
                console.error("Firebase setup failed:", error);
                document.getElementById('user-id-display').textContent = 'Error: See Console';
            }
        }


        // --- Application Initialization ---

        /**
         * The main initialization function for the app.
         */
        function initApp() {
            setupFirebase(); // Start Firebase and Auth setup (replaces loadData)

            // Setup DOM event listeners for forms and buttons
            setupProfileForms();
            setupNavigation();
            setupManualEntry();
            setupGoalForm();
            setupClearLog();
            generateParticles(); // Start the background animation
            
            // The initial render will be handled by the onSnapshot listener once data is loaded.
        }

        // Initialize the application when the window loads
        window.onload = initApp;

        // Ensure window.confirm is explicitly defined as a fallback to avoid errors.
        window.confirm = confirmAction; 

    </script>
</body>
</html>
